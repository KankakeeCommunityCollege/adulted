// Custom JS for Slick img carousels
$(document).ready(function() {
  $('.hero-slider__slider').slick({
    dots: true,
    slidesToShow: 1,
    slidesToScroll: 1,
    autoplay: true,
    autoplaySpeed: 3000,
    prevArrow:'<img alt="" class="a-left control-c prev slick-prev" src="assets/img/dbl-prev.svg">',
    nextArrow:'<img alt="" class="a-right control-c next slick-next" src="assets/img/dbl-next.svg">'
  });

  $('.gallery__button').each(function() {
    var that = $(this);
    var slideTarget = that.data('slide');
    that.on('click', function() {
      setTimeout(function(){
        $('#gallerySlider').slick({
          dots: true,
          initialSlide: that.data('slide'),
          slidesToShow: 1,
          slidesToScroll: 1
        });
      }, 300);
      $('#gallerySlider').slick('slickGoTo', slideTarget );
    });
  });
});

// Lazy load images
// ex. <img data-src="/path/to/image.jpg" alt="">
$(document).ready(function(){
  (function() {
    [].forEach.call(document.querySelectorAll('img[data-src]'), function(img) {
      img.setAttribute('src', img.getAttribute('data-src'));
      img.onload = function() {
        img.removeAttribute('data-src');
      };
    });
  })();
});

// Highlights the current page in local navigation bar
$(document).ready(function () {
  var currentUrl = window.location.href;
  var noProto = currentUrl.replace(/(^\w+:|^)\/\//, '');
  $('#navbarSupportedContent').find('.active').removeClass('active');
  if (noProto == 'foundation.kcc.edu/' || noProto == 'localhost:3000/' ) {
    $('#home').addClass('active');
  } else if (currentUrl.indexOf('/about/') > -1) {
    $('#about').addClass('active');
  } else if (currentUrl.indexOf('/programs/') > -1) {
    $('#programs').addClass('active');
  } else if (currentUrl.indexOf('/alumni/') > -1) {
    $('#alumni').addClass('active');
  } else if (currentUrl.indexOf('/resources/') > -1) {
    $('#resources').addClass('active');
  } else if (currentUrl.indexOf('#contact') > -1) {
    $('#home').addClass('active');
  }
});

// Custom JS to toggle the search form on mobile devices
var imgsrc = $('#searchImg').attr('src');
//function toggler() {
//  if (imgsrc.indexOf('assets/img/search.svg') != -1) {
//    console.log('true');
//    $('#searchImg').attr('src', 'assets/img/x.svg');
//  } else {
//    $('#searchImg').attr('src', 'assets/img/search.svg');
//    console.log('false');
//  }
//}
$('#searchIcon').click(function () {
  function searchCheck() {
    var imgUrl = $('#searchImg').css('background-image');
    if ( imgUrl.indexOf('assets/img/search.svg') != -1 ) {
//      $('#searchImg').css('background-image', '../../../../x.svg');
//      console.log('search');
      $('#searchImg').css('background-image', 'url("http://news.kcc.edu/assets/img/x.svg")');
    } else {
      $('#searchImg').css('background-image', 'url("http://news.kcc.edu/assets/img/search.svg")');
    }
  }
  searchCheck();
  $('#searchCollapse').toggleClass('global-nav__search-collapse--visible');
//  $('#searchImg').css('background-image', 'url('')')
//  toggler();
  $('#mainNav').toggleClass('local-nav--search-toggle');
  $('#globalNav').toggleClass('global-nav--search-toggle');
});


$('document').ready(function () {
  // Inject custom text into Google Custom Search input-field's placeholder text.
  function placeholderText() {
    // Write the "placeholder" attribute . . .
    $('input.gsc-input').attr('placeholder', 'Search KCC...');
  }
  // HOWEVER!! Don't do it for 3,000 milliseconds after document.ready has fired (give Google Custom Search's script time finish). . .
  // otherwise the Google's script overwrites any JS injected customization like this.
  window.setTimeout(placeholderText, 3000);
});

// Custom JS to animate and show the shop Amazon Smile widget
// ===================================================================
$(document).ready(function () {

  var smileWrapper = $('#shopSmileWrapper');

  //function addShaddow() {
  //  var smileTab = $('#smileTab');
  //  setTimeout(function(){
  //    smileTab.addClass('shop-smile__tab--shaddow');
  //  }, 1200);
  //}
  //function removeShaddow() {
  //  var smileTab = $('#smileTab');
  //  smileTab.removeClass('shop-smile__tab--shaddow');
  //}

  if( sessionStorage.clickcount == undefined ) { // if the clickcount is undefined:
    // set the clickcount to 0:
    sessionStorage.clickcount = 0;
  }

  smileWrapper.attr('data-close', sessionStorage.clickcount);

  function animateIn() {
    // Function to animate the slide-in of the amazon smile slide-box
    var deferShowShopSmile = $.Deferred();

    $.when(deferShowShopSmile).done(function() {
      smileWrapper.addClass('shop-smile__wrapper--show');
    });

    function animateShopSmile() {
      smileWrapper.addClass('shop-smile__wrapper--slide-in');
      //$('#greyOut').addClass('shop-smile__grey-out--animate')
      //  .addClass('shop-smile__grey-out--show');
      deferShowShopSmile.resolve();
    }
    animateShopSmile();
  }

  // Run the slide-box animation on page-load after a delay:
  function showShopSmile() {
    if ( smileWrapper.attr('data-close') == 0 ) {
      setTimeout(function(){
        //removeShaddow();
        animateIn();
      }, 2000);
    }
  }
  //  if( localStorage.getItem('user_visted') != 'true' ){
  showShopSmile();
  //    localStorage.setItem('user_visted', 'true');
  //  }

  // Closing the amazon smile slide-box
  function closeSmileWidget() {
    $('#exitButton').click(function() {
      smileWrapper.removeClass('shop-smile__wrapper--slide-in');
      smileWrapper.removeClass('shop-smile__wrapper--show');
      smileWrapper.addClass('shop-smile__wrapper--slide-out');
      clickCounter();
      //$('#greyOut').removeClass('shop-smile__grey-out--animate')
      //  .addClass('shop-smile__grey-out--animate-out')
      //  .removeClass('shop-smile__grey-out--show');
      //addShaddow();
    });
  }
  closeSmileWidget();

  // Reopening the slide-box by clicking it's minimized tab:
  function openSmile() {
    $('#openSmile').on('click', function() {
      //console.log('clicked');
      var wrapperClasses = smileWrapper.hasClass('shop-smile__wrapper--show');
      //console.log(wrapperClasses);
      if ( wrapperClasses == true ) {
        //console.log('show');
        smileWrapper.removeClass('shop-smile__wrapper--slide-in');
        smileWrapper.removeClass('shop-smile__wrapper--show');
        //addShaddow();
        smileWrapper.addClass('shop-smile__wrapper--slide-out');
        clickCounter();
      } else {
        //console.log('NO');
        smileWrapper.removeClass('shop-smile__wrapper--slide-out');
        //removeShaddow();
        animateIn();
      }
    });
  }
  openSmile();

  function clickCounter() {
    if(typeof(Storage) !== 'undefined') {
      if (sessionStorage.clickcount) {
        sessionStorage.clickcount = Number(sessionStorage.clickcount)+1;
      } else {
        sessionStorage.clickcount = 1;
      }
      smileWrapper.attr('data-close', sessionStorage.clickcount);
    }
  }

});
//});

// Custom JS to trigger the shrinking animation/effect on the local-nav when the user scrolls down (and the inverse when the user goes back to the top).
// Collapse Navbar
var navbarCollapse = function() {
  if ($('#mainNav').offset().top > 100) {
    $('#mainNav').addClass('navbar-shrink');
  } else {
    $('#mainNav').removeClass('navbar-shrink');
  }
};
  // Collapse now if page is not at top
navbarCollapse();
// Collapse the navbar when page is scrolled
$(window).scroll(navbarCollapse);

// Builds out the sub-navigation based on whe current URL of the user.
$(document).ready(function() {
  var currentUrl = window.location.href;
  var host = window.location.host + '/';
  // Remove the http(s):// protocol
  var noProto = currentUrl.replace(/(^\w+:|^)\/\//, '');
  // Remove the baseURL (foundation.kcc.edu)
  var noBase = noProto.replace('foundation.kcc.edu/', '');

  function writeSubNav() {

    var programs = 'programs',
      esl = 'esl',
      literacy = 'community-literacy',
      ged = 'ged',
      hse = 'GED/HiSet';

    //console.log(noProto);

    function createList() {

      var listItemStart = '<li class="nav-item">',
        lastListItemStart = '<li class="nav-item active">',
        listItemClose = '</li>',
        // Links:
        linkStart = '<a href="',
        linkPostUrl = '" class="nav-link sub-nav__nav-link" style="text-transform: capitalize;">',
        linkCaps = '" class="nav-link sub-nav__nav-link" style="text-transform: uppercase;">',
        linkNoStyle = '" class="nav-link sub-nav__nav-link">',
        linkClose = '</a>',
        srCurrent = ' <span class="sr-only">(current)</span>';

      var removeSlash = noBase.slice(0,-1);
      var urlArray = removeSlash.split(/\//),
        listString = [];

      var lastItem = urlArray[urlArray.length - 1];
      var arrayLength = urlArray.length;
      //console.log(lastItem);
      //console.log(arrayLength);

      if ( noBase.indexOf(programs) > -1 ) {
        if ( noBase.indexOf(ged) > -1 ) {
          listString.push(
            lastListItemStart + linkStart + '../' + ged + linkNoStyle + hse + srCurrent + linkClose + listItemClose
          );
          listString.push(
            listItemStart + linkStart + '../' + esl + linkCaps + esl.replace(/-/g, ' ') + linkClose + listItemClose
          );
          listString.push(
            listItemStart + linkStart + '../' + literacy + linkPostUrl + literacy.replace(/-/g, ' ') + linkClose + listItemClose
          );
        } else if ( noBase.indexOf(esl) > -1 ) {
          listString.push(
            listItemStart + linkStart + '../' + ged + linkNoStyle + hse + linkClose + listItemClose
          );
          listString.push(
            lastListItemStart + linkStart + '../' + esl + linkCaps + esl.replace(/-/g, ' ') + srCurrent + linkClose + listItemClose
          );
          listString.push(
            listItemStart + linkStart + '../' + literacy + linkPostUrl + literacy.replace(/-/g, ' ') + linkClose + listItemClose
          );
        } else if ( noBase.indexOf(literacy) > -1 ) {
          listString.push(
            listItemStart + linkStart + '../' + ged + linkNoStyle + hse + linkClose + listItemClose
          );
          listString.push(
            listItemStart + linkStart + '../' + esl + linkCaps + esl.replace(/-/g, ' ') + linkClose + listItemClose
          );
          listString.push(
            lastListItemStart + linkStart + '../' + literacy + linkPostUrl + literacy.replace(/-/g, ' ') + linkClose + listItemClose
          );
        } else {
          listString.push(
            listItemStart + linkStart + ged + linkNoStyle + hse + linkClose + listItemClose
          );
          listString.push(
            listItemStart + linkStart + esl + linkCaps + esl.replace(/-/g, ' ') + linkClose + listItemClose
          );
          listString.push(
            listItemStart + linkStart + literacy + linkPostUrl + literacy.replace(/-/g, ' ') + linkClose + listItemClose
          );
        }
      }
      document.getElementById('subNavNav').innerHTML = listString.join('');
    }
    createList();

  }
  var isSubNavPage = noProto !== host && noProto !== host + '#contact' && noProto !== host + 'programs/community-literacy/form/';
  if (isSubNavPage) { writeSubNav(); }
});

// Replace all occurences of "--" (double hyphens) with "—" (long-em dash)
$(document).ready(function() {
  function walkText(node) {
    if (node.nodeType == 3) {
      node.data = node.data.replace(/--/g, '—');
    }
    if (node.nodeType == 1 && node.nodeName != 'SCRIPT') {
      for (var i = 0; i < node.childNodes.length; i++) {
        walkText(node.childNodes[i]);
      }
    }
  }
  walkText(document.body);
});

// Javascript to enable links/external-links to Bootstrap4 tab-nav's
// This provides a way to link to individual alumni stories and have that desired story active on the alumni-stories page when you get there.
$(document).ready(function() {

  var deferScroll = $.Deferred();

  $.when(deferScroll).done(function() {
    setTimeout(function(){
      window.scrollTo(0,0);
    }, 220);
  });

  function linkTabs() {
    var url = document.location.toString();
    if (url.match(/(?!#contact$)#.+/) ) {
      $('.nav-tabs a[href="#'+url.split('#')[1]+'"]').tab('show') ;
      deferScroll.resolve();
    }
  }

  linkTabs();

  // With HTML5 history API, we can easily prevent scrolling!
  //$('.nav-tabs a').on('shown.bs.tab', function (e) {
    //if(history.pushState) {
      //history.pushState(null, null, e.target.hash);
    //} else {
      //window.location.hash = e.target.hash; //Polyfill for old browsers
    //}
  //});
});

// Acordian.JS
// Allows anchor jump-link to work with with acordian function
//

$('.donateTarget').on('click', function() {
  $('#collapseOne').toggle('show').trigger('showCollapsed');
});

$('#collapseOne').on('showCollapsed', function() {
  $('#plusMinus').toggleClass('buttons__minus');
});

$('.plannedTarget').on('click', function() {
  $('#collapseTwo').toggle('show').trigger('showCollapsed2');
});

$('#collapseTwo').on('showCollapsed2', function() {
  $('#plusMinus2').toggleClass('buttons__minus');
});

$('.womensCircleTarget').on('click', function() {
  $('#collapseThree').toggle('show').trigger('showCollapsed3');
});

$('#collapseThree').on('showCollapsed3', function() {
  $('#plusMinus3').toggleClass('buttons__minus');
});

$('.employeeTarget').on('click', function() {
  $('#collapseFour').toggle('show').trigger('showCollapsed4');
});

$('#collapseFour').on('showCollapsed4', function() {
  $('#plusMinus4').toggleClass('buttons__minus');
});

$('.rightsTarget').on('click', function() {
  $('#collapseFive').toggle('show').trigger('showCollapsed5');
});

$('#collapseFive').on('showCollapsed5', function() {
  $('#plusMinus5').toggleClass('buttons__minus');
});

$('.feesTarget').on('click', function() {
  $('#collapseSix').toggle('show').trigger('showCollapsed6');
});

$('#collapseSix').on('showCollapsed6', function() {
  $('#plusMinus6').toggleClass('buttons__minus');
});

// function toggleAccordian() {
//   var plusMinus = document.getElementById('plusMinus');
//   if (plusMinus.firstChild.nodeValue == '+') {
//     plusMinus.firstChild.nodeValue = '-';
//   } else {
//     plusMinus.firstChild.nodeValue = '+';
//   }
// }

// var member = document.getElementById('plusButton');
// member.addEventListener('click', toggleAccordian, false);

// $('#my-link2').click(function() {
//   $('#collapseTwo').collapse('hide');
//   $('#collapseTwo').collapse('show');
// });

// function toggleAccordian2() {
//   var plusMinus = document.getElementById('plusMinus2');
//   if (plusMinus.firstChild.nodeValue == '+') {
//     plusMinus.firstChild.nodeValue = '-';
//   } else {
//     plusMinus.firstChild.nodeValue = '+';
//   }
// }

// var trainer = document.getElementById('plusButton2');
// trainer.addEventListener('click', toggleAccordian2, false);

// Replace all occurences of "--" (double hyphens) with "—" (long-em dash)
(function() {
  var headingArray = document.querySelectorAll('h3.hero-slider__slider--slide-heading');
  headingArray.forEach(function(element) {
    element.innerHTML = element.innerHTML.replace(/\*\*POWER\*\*/g, '<span class="typography__power-text">POWER</span>');
  });
})();

// Sets copyright year
document.addEventListener('DOMContentLoaded', function() {
  var d = new Date(),
    fullYear = d.getFullYear();
  document.getElementById('currentYear').innerHTML = fullYear;
});

// WORK IN PROGRESS BELOW

$('document').ready(function () {


		// RESTYLE THE DROPDOWN MENU
    $('#google_translate_element').on("click", function () {

        // Change font family and color
        $("iframe").contents().find(".goog-te-menu2-item div, .goog-te-menu2-item:link div, .goog-te-menu2-item:visited div, .goog-te-menu2-item:active div, .goog-te-menu2 *")
            .css({
                'color': '#544F4B',
                'font-family': 'Roboto',
								'width':'100%'
            });
        // Change menu's padding
        $("iframe").contents().find('.goog-te-menu2-item-selected').css ('display', 'none');

				// Change menu's padding
        $("iframe").contents().find('.goog-te-menu2').css ({								'overflow-y':'scroll','padding':'0px'});

        // Change the padding of the languages
        $("iframe").contents().find('.goog-te-menu2-item div').css('padding', '20px');

        // Change the width of the languages
        $("iframe").contents().find('.goog-te-menu2-item').css('width', '100%');
        $("iframe").contents().find('td').css('width', '100%');

        // Change hover effects
        $("iframe").contents().find(".goog-te-menu2-item div").hover(function () {
            $(this).css('background-color', '#4385F5').find('span.text').css('color', 'white');
        }, function () {
            $(this).css('background-color', 'white').find('span.text').css('color', '#544F4B');
        });

        // Change Google's default blue border
        $("iframe").contents().find('.goog-te-menu2').css('border', 'none');

        // Change the iframe's box shadow
        $(".goog-te-menu-frame").css('box-shadow', '0 16px 24px 2px rgba(0, 0, 0, 0.14), 0 6px 30px 5px rgba(0, 0, 0, 0.12), 0 8px 10px -5px rgba(0, 0, 0, 0.3)');



        // Change the iframe's size and position?
        $(".goog-te-menu-frame").css({
            'height': '100%',
            'width': '100%',
            'top': '0px'
        });
        // Change iframes's size
        $("iframe").contents().find('.goog-te-menu2').css({
            'height': '100%',
            'width': '100%'
        });
    });
});


document.addEventListener('DOMContentLoaded', function() {
  var currentUrl = window.location.href;
  var host = window.location.host + '/';
  var noProto = currentUrl.replace(/(^\w+:|^)\/\//, '');
  var isJotFormPage = noProto === host + 'programs/community-literacy/form/';
  function watchForIframeLoad(){
    var myIframe = document.querySelector('iframe');
    myIframe.addEventListener('load', function(){
      document.body.scrollTop = document.documentElement.scrollTop = 0; // scroll the page to the top on iframe load (Pulls 'Thank You' message into users view).
    });
  }
  if (isJotFormPage) { watchForIframeLoad(); }
});
